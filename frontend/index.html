<html>
    <head>

    </head>
    <body>
        <script>
            const ws = new WebSocket("ws://localhost:8080", "echo-protocol");
            userId = Math.floor(Math.random(), 10000);
            chatId = Math.floor(Math.random(), 10000);

            ws.onopen = function() {
               ws.send(JSON.stringify({
                    type: "JOIN_ROOM",
                    payload: {
                        name: "Akash",
                        userId: userId,
                        roomId: "2"
                    }
               }));
            }

            ws.onmessage = function(event) {
                try {
                    const {payload, type} = JSON.parse(event.data);
                    if(type == "ADD_CHAT") {
                        const textNode = document.createElement("p");
                        textNode.innerHTML = payload.message + `(${payload.upvotes})`;
                        
                        const button = document.createElement("button");
                        button.innerHTML = `(${payload.upvotes})`;
                        button.setAttribute("onclick", `sendUpvotes(${payload.chatId})`);
                        button.setAttribute("id", `message-${payload.chatId}`);
                        
                        document.getElementById("chats").appendChild(textNode);
                        document.getElementById("chats").appendChild(button);
                    }

                    if(type == "UPDATE_CHAT") {
                        const button = document.getElementById(`message-${payload.chatId}`);
                        button.innerHTML = `(${payload.upvotes})`;
                    }
                } catch (e) {
                    console.error(e)
                }
            }

            function sendUpvotes(chatId) {
                ws.send(JSON.stringify({
                    type: "UPVOTE_MESSAGE",
                    payload: {
                        chatId,
                        userId: userId,
                        roomId: "2"
                    }
               }));
            }

            function sendChat() {
                ws.send(JSON.stringify({
                    type: "SEND_MESSAGE",
                    payload: {
                        message: document.getElementById("inputtext").value,
                        userId: userId,
                        chatId,
                        roomId: "2"
                    }
               }));
            }
        </script>
        <div id = "chats"></div>
        <input type="text" id = "inputtext"/>
        <button onclick="sendChat();">Send</button>
    </body>
</html>