<html>
    <head>

    </head>
    <body>
        <script>
            const ws = new WebSocket("ws://localhost:8080", "echo-protocol");
            userId = Math.floor(Math.random() * 10000);
            userName = "User " + userId + ": ";
            chatId = "2";

            ws.onopen = function() {
               ws.send(JSON.stringify({
                    type: "JOIN_ROOM",
                    payload: {
                        name: userName,
                        userId: userId,
                        roomId: "2"
                    }
               }));
            }

            ws.onmessage = function(event) {
                try {
                    const {payload, type} = JSON.parse(event.data);
                    
                    if(type == "ADD_CHAT") {
                        const textNode = document.createElement("p");
                        textNode.innerHTML = payload.name + ": " + payload.message;
                        
                        const upvoteButton = document.createElement("button");
                        upvoteButton.innerHTML = `(${payload.upvotes})`;
                        upvoteButton.setAttribute("onclick", `sendUpvotes(${payload.chatId})`);
                        upvoteButton.setAttribute("id", `up-message-${payload.chatId}`);

                        const downvoteButton = document.createElement("button");
                        downvoteButton.innerHTML = `(${payload.upvotes})`;
                        downvoteButton.setAttribute("onclick", `sendDownvotes(${payload.chatId})`);
                        downvoteButton.setAttribute("id", `down-message-${payload.chatId}`);
                        
                        document.getElementById("chats").appendChild(textNode);
                        document.getElementById("chats").appendChild(upvoteButton);
                        document.getElementById("chats").appendChild(downvoteButton);
                    }

                    if(type == "UPDATE_CHAT") {
                        const upvoteButton = document.getElementById(`up-message-${payload.chatId}`);
                        upvoteButton.innerHTML = `(${payload.upvotes})`;

                        const downvoteButton = document.getElementById(`down-message-${payload.chatId}`);
                        downvoteButton.innerHTML = `(${payload.downvotes})`;
                    }
                } catch (e) {
                    console.error(e)
                }
            }

            function sendUpvotes(chatId) {
                ws.send(JSON.stringify({
                    type: "UPVOTE_MESSAGE",
                    payload: {
                        chatId,
                        userId: userId,
                        roomId: "2"
                    }
               }));
            }

            function sendDownvotes(chatId) {
                ws.send(JSON.stringify({
                    type: "DOWNVOTE_MESSAGE",
                    payload: {
                        chatId,
                        userId: userId,
                        roomId: "2"
                    }
               }));
            }

            function sendChat() {
                ws.send(JSON.stringify({
                    type: "SEND_MESSAGE",
                    payload: {
                        message: document.getElementById("inputtext").value,
                        userId: userId,
                        chatId,
                        roomId: "2"
                    }
               }));
            }
        </script>
        <div id = "chats"></div>
        <input type="text" id = "inputtext"/>
        <button onclick="sendChat();">Send</button>
    </body>
</html>